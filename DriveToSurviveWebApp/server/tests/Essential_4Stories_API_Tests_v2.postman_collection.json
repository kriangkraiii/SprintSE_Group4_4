{
  "info": {
    "_postman_id": "essential-4-stories-v2",
    "name": "à¸Šà¸¸à¸”à¸—à¸”à¸ªà¸­à¸š API à¸ªà¸³à¸«à¸£à¸±à¸š 4 User Stories (v2)",
    "description": "à¸Šà¸¸à¸”à¸—à¸”à¸ªà¸­à¸š API à¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡ 4 user stories à¸«à¸¥à¸±à¸:\n\n1ï¸âƒ£ à¸£à¸°à¸šà¸šà¸šà¸±à¸™à¸—à¸¶à¸à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸šà¸à¸Žà¸«à¸¡à¸²à¸¢ (Story #1)\n3ï¸âƒ£ à¸£à¸°à¸šà¸šà¹à¸šà¸¥à¹‡à¸„à¸¥à¸´à¸ªà¸•à¹Œà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ (Story #3)\n4ï¸âƒ£ à¸£à¸°à¸šà¸šà¸¢à¸·à¸™à¸¢à¸±à¸™à¸•à¸±à¸§à¸•à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ (Story #4)\nðŸ”Ÿ à¸£à¸°à¸šà¸šà¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸•à¸²à¸¡ PDPA (Story #16)\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ“‹ à¸à¹ˆà¸­à¸™à¸£à¸±à¸™ à¸•à¹‰à¸­à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Variables à¹ƒà¸«à¹‰à¸•à¸£à¸‡:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n1. adminEmail / adminPassword\n   â†’ à¸”à¸¹à¸ˆà¸²à¸à¹„à¸Ÿà¸¥à¹Œ .env à¸‚à¸­à¸‡ server (ADMIN_EMAIL / ADMIN_PASSWORD)\n   â†’ à¸„à¹ˆà¸² default à¸ˆà¸²à¸ README: admin@example.com / secure_password\n\n2. nonAdminEmail / nonAdminPassword\n   â†’ à¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›à¸—à¸µà¹ˆà¸ªà¸¡à¸±à¸„à¸£à¸œà¹ˆà¸²à¸™à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸šà¹à¸¥à¹‰à¸§ (role: PASSENGER)\n   â†’ âš ï¸ à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸ˆà¸£à¸´à¸‡à¹ƒà¸™à¸£à¸°à¸šà¸š à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸«à¹‰à¸ªà¸¡à¸±à¸„à¸£à¸œà¹ˆà¸²à¸™ frontend à¸à¹ˆà¸­à¸™\n\n3. deleteUserEmail / deleteUserPassword\n   â†’ à¸šà¸±à¸à¸Šà¸µà¸—à¸µà¹ˆà¸ˆà¸°à¹ƒà¸Šà¹‰à¸—à¸”à¸ªà¸­à¸šà¸¥à¸š (âš ï¸ à¸ˆà¸°à¸–à¸¹à¸à¸¥à¸šà¸ˆà¸£à¸´à¸‡!)\n   â†’ âš ï¸ à¸•à¹‰à¸­à¸‡à¸ªà¸¡à¸±à¸„à¸£à¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆà¸œà¹ˆà¸²à¸™ frontend à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸šà¸™à¸µà¹‰à¹‚à¸”à¸¢à¹€à¸‰à¸žà¸²à¸°\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ–¶ï¸ à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸£à¸±à¸™:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n1. à¸£à¸±à¸™ '0) à¹€à¸•à¸£à¸µà¸¢à¸¡à¸„à¸§à¸²à¸¡à¸žà¸£à¹‰à¸­à¸¡' à¸à¹ˆà¸­à¸™à¹€à¸ªà¸¡à¸­ (login à¹€à¸à¹‡à¸š token)\n2. à¸£à¸±à¸™ Story 1-3 à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š\n3. à¸£à¸±à¸™ Story 16 à¹€à¸›à¹‡à¸™à¸­à¸±à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ (à¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸ˆà¸£à¸´à¸‡)\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nðŸ”§ à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡à¹‚à¸„à¹‰à¸”:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n- Admin bootstrap: server/src/bootstrap/ensureAdmin.js\n- Login: server/src/controllers/auth.controller.js\n- System Log: server/src/routes/systemLog.routes.js\n- Blacklist: server/src/routes/blacklist.routes.js\n- Driver Verification: server/src/routes/driverVerification.routes.js + iapp.routes.js\n- Account Deletion: server/src/routes/user.routes.js",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3001/api", "type": "string" },

    { "key": "adminEmail", "value": "admin@example.com", "type": "string" },
    { "key": "adminPassword", "value": "secure_password", "type": "string" },

    { "key": "nonAdminEmail", "value": "testpassenger@test.com", "type": "string" },
    { "key": "nonAdminPassword", "value": "Test1234", "type": "string" },

    { "key": "deleteUserEmail", "value": "testdelete@test.com", "type": "string" },
    { "key": "deleteUserPassword", "value": "Test1234", "type": "string" },

    { "key": "adminToken", "value": "", "type": "string" },
    { "key": "nonAdminToken", "value": "", "type": "string" },
    { "key": "deleteUserToken", "value": "", "type": "string" },

    { "key": "testNationalId", "value": "", "type": "string" },
    { "key": "blacklistId", "value": "", "type": "string" },
    { "key": "deletedUserId", "value": "", "type": "string" },

    { "key": "dummyVerificationId", "value": "cm00000000000000000000000", "type": "string" }
  ],
  "item": [
    {
      "name": "0) à¹€à¸•à¸£à¸µà¸¢à¸¡à¸„à¸§à¸²à¸¡à¸žà¸£à¹‰à¸­à¸¡ - Login à¹à¸¥à¸°à¹€à¸à¹‡à¸š Token",
      "item": [
        {
          "name": "0.1 à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => res.to.have.status(200));",
                  "",
                  "const body = res.json();",
                  "pm.test('response.success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "",
                  "const token = body?.data?.token;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ token à¹ƒà¸™ data.token', () => {",
                  "  pm.expect(token).to.be.a('string');",
                  "  pm.expect(token.length).to.be.above(10);",
                  "});",
                  "",
                  "if (token) pm.collectionVariables.set('adminToken', token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        },
        {
          "name": "0.2 à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const email = pm.collectionVariables.get('nonAdminEmail');",
                  "if (!email || email.includes('à¹à¸à¹‰à¹ƒà¸«à¹‰à¸•à¸£à¸‡')) {",
                  "  console.warn('âš ï¸ nonAdminEmail à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² à¸à¸£à¸¸à¸“à¸²à¹à¸à¹‰à¹„à¸‚à¹ƒà¸™ Collection Variables');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200 (à¸–à¹‰à¸² fail à¹ƒà¸«à¹‰à¸•à¸£à¸§à¸ˆ nonAdminEmail/Password)', () => res.to.have.status(200));",
                  "",
                  "const body = res.json();",
                  "const token = body?.data?.token;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ token', () => {",
                  "  pm.expect(token).to.be.a('string');",
                  "  pm.expect(token.length).to.be.above(10);",
                  "});",
                  "",
                  "if (token) pm.collectionVariables.set('nonAdminToken', token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{nonAdminEmail}}\",\n  \"password\": \"{{nonAdminPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        },
        {
          "name": "0.3 à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸šà¸¥à¸šà¸šà¸±à¸à¸Šà¸µ",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const email = pm.collectionVariables.get('deleteUserEmail');",
                  "if (!email || email.includes('à¹à¸à¹‰à¹ƒà¸«à¹‰à¸•à¸£à¸‡')) {",
                  "  console.warn('âš ï¸ deleteUserEmail à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² à¸à¸£à¸¸à¸“à¸²à¹à¸à¹‰à¹„à¸‚à¹ƒà¸™ Collection Variables');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200 (à¸–à¹‰à¸² fail à¹ƒà¸«à¹‰à¸•à¸£à¸§à¸ˆ deleteUserEmail/Password)', () => res.to.have.status(200));",
                  "",
                  "const body = res.json();",
                  "const token = body?.data?.token;",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ token', () => {",
                  "  pm.expect(token).to.be.a('string');",
                  "  pm.expect(token.length).to.be.above(10);",
                  "});",
                  "",
                  "if (token) pm.collectionVariables.set('deleteUserToken', token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{deleteUserEmail}}\",\n  \"password\": \"{{deleteUserPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        }
      ]
    },

    {
      "name": "1) à¸£à¸°à¸šà¸šà¸šà¸±à¸™à¸—à¸¶à¸à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸šà¸à¸Žà¸«à¸¡à¸²à¸¢",
      "description": "Story #1: As an admin, I want a log that complies to the related law.\n\nAPI: GET /system-logs (admin only, immutable â€” à¹„à¸¡à¹ˆà¸¡à¸µ PUT/DELETE)\nà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡: à¸ž.à¸£.à¸š.à¸„à¸­à¸¡à¸žà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ à¸ž.à¸¨. 2560 à¸¡à¸²à¸•à¸£à¸² 26",
      "item": [
        {
          "name": "1.1 Admin à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ log à¹„à¸”à¹‰à¸ªà¸³à¹€à¸£à¹‡à¸ˆ -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "pm.test('data à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ array', () => pm.expect(body.data).to.be.an('array'));",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ pagination à¸„à¸£à¸š', () => {",
                  "  pm.expect(body.pagination).to.have.property('page');",
                  "  pm.expect(body.pagination).to.have.property('limit');",
                  "  pm.expect(body.pagination).to.have.property('total');",
                  "  pm.expect(body.pagination).to.have.property('totalPages');",
                  "});",
                  "pm.test('pagination.page à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¹€à¸¥à¸‚', () => {",
                  "  pm.expect(typeof body.pagination.page).to.be.oneOf(['number','string']);",
                  "});",
                  "pm.test('pagination.totalPages à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ finite', () => {",
                  "  pm.expect(Number.isFinite(Number(body.pagination.totalPages))).to.eql(true);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/system-logs", "host": ["{{baseUrl}}"], "path": ["system-logs"] }
          }
        },
        {
          "name": "1.2 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡ log à¹„à¸”à¹‰ -> 403",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 403 Forbidden', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/system-logs", "host": ["{{baseUrl}}"], "path": ["system-logs"] }
          }
        },
        {
          "name": "1.3 à¹„à¸¡à¹ˆà¸¡à¸µ Token à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ -> 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 401 Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/system-logs", "host": ["{{baseUrl}}"], "path": ["system-logs"] }
          }
        },
        {
          "name": "1.4 Token à¸›à¸¥à¸­à¸¡à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ -> 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 401 Unauthorized', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "fake.invalid.token", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/system-logs", "host": ["{{baseUrl}}"], "path": ["system-logs"] }
          }
        },
        {
          "name": "1.5 à¸«à¹‰à¸²à¸¡à¸¥à¸š log (Immutable à¸•à¸²à¸¡ à¸ž.à¸£.à¸š.à¸„à¸­à¸¡à¸žà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ à¸¡.26) -> 404",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰ 404 (à¹„à¸¡à¹ˆà¸¡à¸µ DELETE route)', () => pm.expect([404,405]).to.include(pm.response.code));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/system-logs/1", "host": ["{{baseUrl}}"], "path": ["system-logs", "1"] }
          }
        },
        {
          "name": "1.6 à¸«à¹‰à¸²à¸¡à¹à¸à¹‰à¹„à¸‚ log (Immutable à¸•à¸²à¸¡ à¸ž.à¸£.à¸š.à¸„à¸­à¸¡à¸žà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ à¸¡.26) -> 404",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰ 404 (à¹„à¸¡à¹ˆà¸¡à¸µ PUT route)', () => pm.expect([404,405]).to.include(pm.response.code));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{ \"action\": \"hacked\" }" },
            "url": { "raw": "{{baseUrl}}/system-logs/1", "host": ["{{baseUrl}}"], "path": ["system-logs", "1"] }
          }
        }
      ]
    },

    {
      "name": "2) à¸£à¸°à¸šà¸šà¹à¸šà¸¥à¹‡à¸„à¸¥à¸´à¸ªà¸•à¹Œà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™",
      "description": "Story #3: As an admin, I want to create a blacklist of both the drivers and the passengers.\n\nAPIs: GET/POST/DELETE /blacklist (admin), POST /blacklist/check (protected)\nà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡: PDPA à¸ž.à¸¨. 2562 à¸¡à¸²à¸•à¸£à¸² 22 â€” à¹€à¸à¹‡à¸šà¹€à¸‰à¸žà¸²à¸° SHA-256 Hash",
      "item": [
        {
          "name": "2.1 Admin à¹€à¸žà¸´à¹ˆà¸¡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸‚à¹‰à¸² blacklist à¸ªà¸³à¹€à¸£à¹‡à¸ˆ -> 201",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "let n = String(Date.now());",
                  "while (n.length < 13) n += '0';",
                  "if (n.length > 13) n = n.slice(0, 13);",
                  "pm.collectionVariables.set('testNationalId', n);",
                  "console.log('à¸ªà¸£à¹‰à¸²à¸‡ testNationalId:', n);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 201 Created', () => pm.response.to.have.status(201));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ data.id (blacklist entry ID)', () => {",
                  "  pm.expect(body.data).to.have.property('id');",
                  "});",
                  "",
                  "pm.test('à¹„à¸¡à¹ˆà¸„à¸·à¸™à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸”à¸´à¸šà¹ƒà¸™ response (PDPA à¸¡.22)', () => {",
                  "  const raw = pm.collectionVariables.get('testNationalId');",
                  "  pm.expect(JSON.stringify(body)).to.not.include(raw);",
                  "});",
                  "",
                  "if (body?.data?.id) {",
                  "  pm.collectionVariables.set('blacklistId', String(body.data.id));",
                  "  console.log('à¹€à¸à¹‡à¸š blacklistId:', body.data.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nationalId\": \"{{testNationalId}}\",\n  \"reason\": \"à¸—à¸”à¸ªà¸­à¸šà¸£à¸°à¸šà¸š blacklist\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/blacklist", "host": ["{{baseUrl}}"], "path": ["blacklist"] }
          }
        },
        {
          "name": "2.2 à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸‹à¹‰à¸³à¹„à¸¡à¹ˆà¹„à¸”à¹‰ -> 409",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 409 Conflict', () => pm.response.to.have.status(409));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nationalId\": \"{{testNationalId}}\",\n  \"reason\": \"à¸‹à¹‰à¸³\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/blacklist", "host": ["{{baseUrl}}"], "path": ["blacklist"] }
          }
        },
        {
          "name": "2.3 à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ blacklist -> 200 + isBlacklisted=true",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "pm.test('isBlacklisted à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.isBlacklisted).to.eql(true));",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ reason à¹ƒà¸™ data', () => pm.expect(body.data).to.have.property('reason'));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nationalId\": \"{{testNationalId}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/blacklist/check", "host": ["{{baseUrl}}"], "path": ["blacklist", "check"] }
          }
        },
        {
          "name": "2.4 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£ blacklist à¹„à¸”à¹‰ -> 403",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 403 Forbidden', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/blacklist", "host": ["{{baseUrl}}"], "path": ["blacklist"] }
          }
        },
        {
          "name": "2.5 Admin à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£ blacklist à¸žà¸£à¹‰à¸­à¸¡ pagination -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "pm.test('data à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ array', () => pm.expect(body.data).to.be.an('array'));",
                  "pm.test('pagination.totalPages à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¹€à¸¥à¸‚ finite', () => {",
                  "  pm.expect(Number.isFinite(Number(body.pagination.totalPages))).to.eql(true);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/blacklist", "host": ["{{baseUrl}}"], "path": ["blacklist"] }
          }
        },
        {
          "name": "2.6 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸žà¸´à¹ˆà¸¡ blacklist à¹„à¸”à¹‰ -> 403",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 403 Forbidden', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"nationalId\": \"1234567890123\",\n  \"reason\": \"hack\"\n}" },
            "url": { "raw": "{{baseUrl}}/blacklist", "host": ["{{baseUrl}}"], "path": ["blacklist"] }
          }
        },
        {
          "name": "2.7 à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸” - Admin à¸¥à¸šà¸­à¸­à¸à¸ˆà¸²à¸ blacklist -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(pm.response.json().success).to.eql(true));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/blacklist/{{blacklistId}}", "host": ["{{baseUrl}}"], "path": ["blacklist", "{{blacklistId}}"] }
          }
        },
        {
          "name": "2.8 à¸¢à¸·à¸™à¸¢à¸±à¸™ - à¸«à¸¥à¸±à¸‡à¸¥à¸šà¹à¸¥à¹‰à¸§à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ blacklist -> isBlacklisted=false",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('isBlacklisted à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ false à¸«à¸¥à¸±à¸‡à¸¥à¸š', () => pm.expect(body.isBlacklisted).to.eql(false));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nationalId\": \"{{testNationalId}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/blacklist/check", "host": ["{{baseUrl}}"], "path": ["blacklist", "check"] }
          }
        }
      ]
    },

    {
      "name": "3) à¸£à¸°à¸šà¸šà¸¢à¸·à¸™à¸¢à¸±à¸™à¸•à¸±à¸§à¸•à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´",
      "description": "Story #4: As an admin, I want an automated user verification.\n\nAPIs:\n- GET /driver-verifications/me (user)\n- POST /driver-verifications (user + files)\n- POST /driver-verifications/ocr (user + files)\n- PATCH /driver-verifications/:id/status (admin)\n- POST /ocr/* (OCR/IAPP endpoints)",
      "item": [
        {
          "name": "3.1 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸”à¸¹à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸¢à¸·à¸™à¸¢à¸±à¸™à¸•à¸±à¸§à¸•à¸™à¸‚à¸­à¸‡à¸•à¸™à¹€à¸­à¸‡ -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(pm.response.json().success).to.eql(true));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/driver-verifications/me", "host": ["{{baseUrl}}"], "path": ["driver-verifications", "me"] }
          }
        },
        {
          "name": "3.2 à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­à¸¢à¸·à¸™à¸¢à¸±à¸™à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (à¸‚à¸²à¸”à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"licenseNumber\": \"TEST-0000\",\n  \"firstNameOnLicense\": \"à¸—à¸”à¸ªà¸­à¸š\",\n  \"lastNameOnLicense\": \"à¸£à¸°à¸šà¸š\",\n  \"typeOnLicense\": \"PRIVATE_CAR\",\n  \"licenseIssueDate\": \"2024-01-01\",\n  \"licenseExpiryDate\": \"2030-01-01\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/driver-verifications", "host": ["{{baseUrl}}"], "path": ["driver-verifications"] }
          }
        },
        {
          "name": "3.3 à¸ªà¹ˆà¸‡ OCR à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (à¸‚à¸²à¸”à¹„à¸Ÿà¸¥à¹Œà¸—à¸µà¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/driver-verifications/ocr", "host": ["{{baseUrl}}"], "path": ["driver-verifications", "ocr"] }
          }
        },
        {
          "name": "3.4 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹ˆà¸§à¹„à¸›à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸ªà¸–à¸²à¸™à¸°à¹„à¸¡à¹ˆà¹„à¸”à¹‰ -> 403",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 403 (à¹€à¸‰à¸žà¸²à¸° admin à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™)', () => pm.response.to.have.status(403));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "PATCH",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"status\": \"APPROVED\"\n}" },
            "url": {
              "raw": "{{baseUrl}}/driver-verifications/{{dummyVerificationId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["driver-verifications", "{{dummyVerificationId}}", "status"]
            }
          }
        },
        {
          "name": "3.5 OCR à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™à¸”à¹‰à¸²à¸™à¸«à¸™à¹‰à¸² à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸¹à¸› -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (Image file is required)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/id-card/front", "host": ["{{baseUrl}}"], "path": ["ocr", "id-card", "front"] }
          }
        },
        {
          "name": "3.6 OCR à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™à¸”à¹‰à¸²à¸™à¸«à¸¥à¸±à¸‡ à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸¹à¸› -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (Image file is required)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/id-card/back", "host": ["{{baseUrl}}"], "path": ["ocr", "id-card", "back"] }
          }
        },
        {
          "name": "3.7 OCR à¸¢à¸·à¸™à¸¢à¸±à¸™à¹ƒà¸šà¸«à¸™à¹‰à¸² à¹„à¸¡à¹ˆà¸¡à¸µà¹„à¸Ÿà¸¥à¹Œ -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (idCardImage and selfieImage required)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/face-id-verification", "host": ["{{baseUrl}}"], "path": ["ocr", "face-id-verification"] }
          }
        },
        {
          "name": "3.8 OCR à¹ƒà¸šà¸‚à¸±à¸šà¸‚à¸µà¹ˆ à¹„à¸¡à¹ˆà¸¡à¸µ token -> 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 401 (à¸•à¹‰à¸­à¸‡ login à¸à¹ˆà¸­à¸™)', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/driver-license", "host": ["{{baseUrl}}"], "path": ["ocr", "driver-license"] }
          }
        },
        {
          "name": "3.9 OCR à¹ƒà¸šà¸‚à¸±à¸šà¸‚à¸µà¹ˆ à¸¡à¸µ token à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸¹à¸› -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (Image file is required)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{nonAdminToken}}", "type": "string" }] },
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/driver-license", "host": ["{{baseUrl}}"], "path": ["ocr", "driver-license"] }
          }
        },
        {
          "name": "3.10 OCR à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸£à¸– à¹„à¸¡à¹ˆà¸¡à¸µ token -> 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 401 (à¸•à¹‰à¸­à¸‡ login à¸à¹ˆà¸­à¸™)', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/ocr/vehicle-registration", "host": ["{{baseUrl}}"], "path": ["ocr", "vehicle-registration"] }
          }
        }
      ]
    },

    {
      "name": "4) à¸£à¸°à¸šà¸šà¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸•à¸²à¸¡ PDPA [âš ï¸ à¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸ˆà¸£à¸´à¸‡]",
      "description": "Story #16: As a user, I want my account and information to be removed from the system.\n\nAPIs:\n- DELETE /users/me (user self-delete)\n- GET /users/admin/:id (admin à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š anonymize)\n- POST /auth/login (à¸¢à¸·à¸™à¸¢à¸±à¸™à¸§à¹ˆà¸² login à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸«à¸¥à¸±à¸‡à¸¥à¸š)\n\nâš ï¸ à¸„à¸³à¹€à¸•à¸·à¸­à¸™: à¸—à¸”à¸ªà¸­à¸šà¸™à¸µà¹‰à¸ˆà¸°à¸¥à¸šà¸šà¸±à¸à¸Šà¸µ deleteUserEmail à¸ˆà¸£à¸´à¸‡!\nà¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡: PDPA à¸¡.33 (Right to Erasure) + à¸ž.à¸£.à¸š.à¸„à¸­à¸¡à¸žà¸´à¸§à¹€à¸•à¸­à¸£à¹Œ à¸¡.26 (à¹€à¸à¹‡à¸š Log)",
      "item": [
        {
          "name": "4.1 à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸•à¸™à¹€à¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "pm.test('success à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ true', () => pm.expect(body.success).to.eql(true));",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¸¡à¸µ deletedUserId', () => {",
                  "  pm.expect(body.data).to.have.property('deletedUserId');",
                  "  pm.expect(body.data.deletedUserId).to.be.a('string');",
                  "  pm.expect(body.data.deletedUserId.length).to.be.above(0);",
                  "});",
                  "",
                  "if (body?.data?.deletedUserId) {",
                  "  pm.collectionVariables.set('deletedUserId', body.data.deletedUserId);",
                  "  console.log('à¹€à¸à¹‡à¸š deletedUserId:', body.data.deletedUserId);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{deleteUserToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/users/me", "host": ["{{baseUrl}}"], "path": ["users", "me"] }
          }
        },
        {
          "name": "4.2 à¸¥à¸šà¸šà¸±à¸à¸Šà¸µà¸‹à¹‰à¸³à¹„à¸¡à¹ˆà¹„à¸”à¹‰ -> 400",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 400 (User already deleted)', () => pm.response.to.have.status(400));"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{deleteUserToken}}", "type": "string" }] },
            "method": "DELETE",
            "url": { "raw": "{{baseUrl}}/users/me", "host": ["{{baseUrl}}"], "path": ["users", "me"] }
          }
        },
        {
          "name": "4.3 Admin à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸–à¸¹à¸ anonymize à¸•à¸²à¸¡ PDPA -> 200",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const body = pm.response.json();",
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 200', () => pm.response.to.have.status(200));",
                  "",
                  "const u = body?.data || {};",
                  "pm.test('firstName à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ Deleted', () => pm.expect(u.firstName).to.eql('Deleted'));",
                  "pm.test('lastName à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ User', () => pm.expect(u.lastName).to.eql('User'));",
                  "pm.test('isActive à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ false', () => pm.expect(u.isActive).to.eql(false));",
                  "pm.test('nationalIdNumber à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ null', () => pm.expect(u.nationalIdNumber).to.eql(null));",
                  "pm.test('phoneNumber à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ null', () => pm.expect(u.phoneNumber).to.eql(null));",
                  "pm.test('email à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ deleted_xxx@removed.local', () => {",
                  "  pm.expect(u.email).to.include('@removed.local');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{adminToken}}", "type": "string" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/users/admin/{{deletedUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "admin", "{{deletedUserId}}"]
            }
          }
        },
        {
          "name": "4.4 à¸šà¸±à¸à¸Šà¸µà¸—à¸µà¹ˆà¸–à¸¹à¸à¸¥à¸šà¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸– login à¹„à¸”à¹‰ -> 401",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸ªà¸–à¸²à¸™à¸° 401 (à¸šà¸±à¸à¸Šà¸µà¸–à¸¹à¸ deactivate à¹à¸¥à¹‰à¸§)', () => pm.response.to.have.status(401));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{deleteUserEmail}}\",\n  \"password\": \"{{deleteUserPassword}}\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          }
        }
      ]
    }
  ]
}
